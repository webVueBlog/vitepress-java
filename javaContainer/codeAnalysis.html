<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>三、源码分析 | Java</title>
    <meta name="description" content="我的Java文档是一个 Java 核心技术教程。">
    <meta name="generator" content="VitePress v1.1.3">
    <link rel="preload stylesheet" href="/vitepress-java/assets/style.mybcdOFq.css" as="style">
    
    <script type="module" src="/vitepress-java/assets/app.qvtp26C6.js"></script>
    <link rel="preload" href="/vitepress-java/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/vitepress-java/assets/chunks/theme.Bj9eQ0Nz.js">
    <link rel="modulepreload" href="/vitepress-java/assets/chunks/framework.CbRyzB36.js">
    <link rel="modulepreload" href="/vitepress-java/assets/javaContainer_codeAnalysis.md.DFus7MAX.lean.js">
    <link rel="icon" href="/logo.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-29fcaef6><!--[--><!--]--><!--[--><span tabindex="-1" data-v-09249bcb></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-09249bcb> Skip to content </a><!--]--><!----><header class="VPNav" data-v-29fcaef6 data-v-5523fc54><div class="VPNavBar has-sidebar top" data-v-5523fc54 data-v-9d42b724><div class="wrapper" data-v-9d42b724><div class="container" data-v-9d42b724><div class="title" data-v-9d42b724><div class="VPNavBarTitle has-sidebar" data-v-9d42b724 data-v-0f0c6c1c><a class="title" href="/vitepress-java/" data-v-0f0c6c1c><!--[--><!--]--><!----><span data-v-0f0c6c1c>Java</span><!--[--><!--]--></a></div></div><div class="content" data-v-9d42b724><div class="content-body" data-v-9d42b724><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9d42b724><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9d42b724 data-v-45d4b27d><span id="main-nav-aria-label" class="visually-hidden" data-v-45d4b27d>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/vitepress-java/" tabindex="0" data-v-45d4b27d data-v-4f1dfd20><!--[--><span data-v-4f1dfd20>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-45d4b27d data-v-3f4bdc65><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3f4bdc65><span class="text" data-v-3f4bdc65><!----><span data-v-3f4bdc65>软件安装配置</span><span class="vpi-chevron-down text-icon" data-v-3f4bdc65></span></span></button><div class="menu" data-v-3f4bdc65><div class="VPMenu" data-v-3f4bdc65 data-v-b00bcbf7><div class="items" data-v-b00bcbf7><!--[--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>开发环境</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/JDK.html" data-v-28823fdc><!--[-->JDK 安装<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Maven.html" data-v-28823fdc><!--[-->Maven 安装<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Nodejs.html" data-v-28823fdc><!--[-->Nodejs 安装<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/emqx.html" data-v-28823fdc><!--[-->EMQX Docker安装<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>开发工具</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Nexus.html" data-v-28823fdc><!--[-->Nexus 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Gitlab.html" data-v-28823fdc><!--[-->Gitlab 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Jenkins.html" data-v-28823fdc><!--[-->Jenkins 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Svn.html" data-v-28823fdc><!--[-->Svn 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/YApi.html" data-v-28823fdc><!--[-->YApi 运维<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>中间件服务</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Elastic.html" data-v-28823fdc><!--[-->Elastic 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/RocketMQ.html" data-v-28823fdc><!--[-->RocketMQ 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Nacos.html" data-v-28823fdc><!--[-->Nacos 运维<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>服务器</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Tomcat.html" data-v-28823fdc><!--[-->Tomcat 运维<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>大数据服务</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/soft/Kafka.html" data-v-28823fdc><!--[-->Kafka 运维<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-45d4b27d data-v-3f4bdc65><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3f4bdc65><span class="text" data-v-3f4bdc65><!----><span data-v-3f4bdc65>日志</span><span class="vpi-chevron-down text-icon" data-v-3f4bdc65></span></span></button><div class="menu" data-v-3f4bdc65><div class="VPMenu" data-v-3f4bdc65 data-v-b00bcbf7><div class="items" data-v-b00bcbf7><!--[--><!--[--><div class="VPMenuGroup" data-v-b00bcbf7 data-v-5b8d5dc1><p class="title" data-v-5b8d5dc1>Nginx 极简教程</p><!--[--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/nginx-tutorial/nginx-quickstart.html" data-v-28823fdc><!--[-->Nginx 快速教程<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/nginx-tutorial/nginx-ops.html" data-v-28823fdc><!--[-->Nginx 运维<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/nginx-tutorial/nginx-configuration.html" data-v-28823fdc><!--[-->Nginx 配置<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-5b8d5dc1 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/nginx-tutorial/nginx-faq.html" data-v-28823fdc><!--[-->Nginx 问题<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-45d4b27d data-v-3f4bdc65><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-3f4bdc65><span class="text" data-v-3f4bdc65><!----><span data-v-3f4bdc65>1.0.0</span><span class="vpi-chevron-down text-icon" data-v-3f4bdc65></span></span></button><div class="menu" data-v-3f4bdc65><div class="VPMenu" data-v-3f4bdc65 data-v-b00bcbf7><div class="items" data-v-b00bcbf7><!--[--><!--[--><div class="VPMenuLink" data-v-b00bcbf7 data-v-28823fdc><a class="VPLink link" href="/vitepress-java/changelog.html" data-v-28823fdc><!--[-->更新日志<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9d42b724 data-v-42b02bb2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-42b02bb2 data-v-a3685a7a data-v-31f9acc6><span class="check" data-v-31f9acc6><span class="icon" data-v-31f9acc6><!--[--><span class="vpi-sun sun" data-v-a3685a7a></span><span class="vpi-moon moon" data-v-a3685a7a></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9d42b724 data-v-a4364112 data-v-fda5be10><!--[--><a class="VPSocialLink no-icon" href="https://weixin.qq.com/" aria-label="wechat" target="_blank" rel="noopener" data-v-fda5be10 data-v-2edc9c47><svg t="1703483542872" class="icon" viewBox="0 0 1309 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6274" width="200" height="200"><path d="M1147.26896 912.681417l34.90165 111.318583-127.165111-66.823891a604.787313 604.787313 0 0 1-139.082747 22.263717c-220.607239 0-394.296969-144.615936-394.296969-322.758409s173.526026-322.889372 394.296969-322.889372C1124.219465 333.661082 1309.630388 478.669907 1309.630388 656.550454c0 100.284947-69.344929 189.143369-162.361428 256.130963zM788.070086 511.869037a49.11114 49.11114 0 0 0-46.360916 44.494692 48.783732 48.783732 0 0 0 46.360916 44.494693 52.090549 52.090549 0 0 0 57.983885-44.494693 52.385216 52.385216 0 0 0-57.983885-44.494692z m254.985036 0a48.881954 48.881954 0 0 0-46.09899 44.494692 48.620028 48.620028 0 0 0 46.09899 44.494693 52.385216 52.385216 0 0 0 57.983886-44.494693 52.58166 52.58166 0 0 0-57.951145-44.494692z m-550.568615 150.018161a318.567592 318.567592 0 0 0 14.307712 93.212943c-14.307712 1.080445-28.746387 1.768001-43.283284 1.768001a827.293516 827.293516 0 0 1-162.394168-22.296458l-162.001279 77.955749 46.328175-133.811485C69.410411 600.858422 0 500.507993 0 378.38496 0 166.683208 208.689602 0 463.510935 0c227.908428 0 427.594322 133.18941 467.701752 312.379588a427.463358 427.463358 0 0 0-44.625655-2.619261c-220.24709 0-394.100524 157.74498-394.100525 352.126871zM312.90344 189.143369a64.270111 64.270111 0 0 0-69.803299 55.659291 64.532037 64.532037 0 0 0 69.803299 55.659292 53.694846 53.694846 0 0 0 57.852923-55.659292 53.465661 53.465661 0 0 0-57.852923-55.659291z m324.428188 0a64.040926 64.040926 0 0 0-69.574114 55.659291 64.302852 64.302852 0 0 0 69.574114 55.659292 53.694846 53.694846 0 0 0 57.951145-55.659292 53.465661 53.465661 0 0 0-57.951145-55.659291z" p-id="6275"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9d42b724 data-v-269e0d65 data-v-3f4bdc65><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-3f4bdc65><span class="vpi-more-horizontal icon" data-v-3f4bdc65></span></button><div class="menu" data-v-3f4bdc65><div class="VPMenu" data-v-3f4bdc65 data-v-b00bcbf7><!----><!--[--><!--[--><!----><div class="group" data-v-269e0d65><div class="item appearance" data-v-269e0d65><p class="label" data-v-269e0d65>深浅模式</p><div class="appearance-action" data-v-269e0d65><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to light theme" aria-checked="true" data-v-269e0d65 data-v-a3685a7a data-v-31f9acc6><span class="check" data-v-31f9acc6><span class="icon" data-v-31f9acc6><!--[--><span class="vpi-sun sun" data-v-a3685a7a></span><span class="vpi-moon moon" data-v-a3685a7a></span><!--]--></span></span></button></div></div></div><div class="group" data-v-269e0d65><div class="item social-links" data-v-269e0d65><div class="VPSocialLinks social-links-list" data-v-269e0d65 data-v-fda5be10><!--[--><a class="VPSocialLink no-icon" href="https://weixin.qq.com/" aria-label="wechat" target="_blank" rel="noopener" data-v-fda5be10 data-v-2edc9c47><svg t="1703483542872" class="icon" viewBox="0 0 1309 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6274" width="200" height="200"><path d="M1147.26896 912.681417l34.90165 111.318583-127.165111-66.823891a604.787313 604.787313 0 0 1-139.082747 22.263717c-220.607239 0-394.296969-144.615936-394.296969-322.758409s173.526026-322.889372 394.296969-322.889372C1124.219465 333.661082 1309.630388 478.669907 1309.630388 656.550454c0 100.284947-69.344929 189.143369-162.361428 256.130963zM788.070086 511.869037a49.11114 49.11114 0 0 0-46.360916 44.494692 48.783732 48.783732 0 0 0 46.360916 44.494693 52.090549 52.090549 0 0 0 57.983885-44.494693 52.385216 52.385216 0 0 0-57.983885-44.494692z m254.985036 0a48.881954 48.881954 0 0 0-46.09899 44.494692 48.620028 48.620028 0 0 0 46.09899 44.494693 52.385216 52.385216 0 0 0 57.983886-44.494693 52.58166 52.58166 0 0 0-57.951145-44.494692z m-550.568615 150.018161a318.567592 318.567592 0 0 0 14.307712 93.212943c-14.307712 1.080445-28.746387 1.768001-43.283284 1.768001a827.293516 827.293516 0 0 1-162.394168-22.296458l-162.001279 77.955749 46.328175-133.811485C69.410411 600.858422 0 500.507993 0 378.38496 0 166.683208 208.689602 0 463.510935 0c227.908428 0 427.594322 133.18941 467.701752 312.379588a427.463358 427.463358 0 0 0-44.625655-2.619261c-220.24709 0-394.100524 157.74498-394.100525 352.126871zM312.90344 189.143369a64.270111 64.270111 0 0 0-69.803299 55.659291 64.532037 64.532037 0 0 0 69.803299 55.659292 53.694846 53.694846 0 0 0 57.852923-55.659292 53.465661 53.465661 0 0 0-57.852923-55.659291z m324.428188 0a64.040926 64.040926 0 0 0-69.574114 55.659291 64.302852 64.302852 0 0 0 69.574114 55.659292 53.694846 53.694846 0 0 0 57.951145-55.659292 53.465661 53.465661 0 0 0-57.951145-55.659291z" p-id="6275"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9d42b724 data-v-a5fe5f34><span class="container" data-v-a5fe5f34><span class="top" data-v-a5fe5f34></span><span class="middle" data-v-a5fe5f34></span><span class="bottom" data-v-a5fe5f34></span></span></button></div></div></div></div><div class="divider" data-v-9d42b724><div class="divider-line" data-v-9d42b724></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-29fcaef6 data-v-f744a42e><div class="container" data-v-f744a42e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f744a42e><span class="vpi-align-left menu-icon" data-v-f744a42e></span><span class="menu-text" data-v-f744a42e>目录</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f744a42e data-v-94898ecc><button data-v-94898ecc>返回顶部</button><!----></div></div></div><aside class="VPSidebar" data-v-29fcaef6 data-v-497d8e6d><div class="curtain" data-v-497d8e6d></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-497d8e6d><span class="visually-hidden" id="sidebar-aria-label" data-v-497d8e6d> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>介绍</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/preface.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>其他博客框架</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>Java 基础</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/data-types.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>一、数据类型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/string.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>二、String</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/by.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>三、运算</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/key-value.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>四、关键字</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/Object.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>五、Object 通用方法</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/extend.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>六、继承</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/reflection.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>七、反射</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/exception.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>八、异常</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/T.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>九、泛型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/annotation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十、注解</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/java/Inference.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十一、特性</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible has-active" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>Java 容器</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaContainer/overview.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>一、概览</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaContainer/design.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>二、容器中的设计模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaContainer/codeAnalysis.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>三、源码分析</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>Java 并发</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/useThread.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>一、使用线程</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/basicThreading.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>二、基础线程机制</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/interrupt.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>三、中断</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/exclusiveSynchronization.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>四、互斥同步</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/collaborationThreads.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>五、线程之间的协作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/threadState.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>六、线程状态</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/juc-aqs.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>七、J.U.C - AQS</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/juc-other.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>八、J.U.C - 其它组件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/exampleThread.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>九、线程不安全示例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/memoryModel.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十、Java 内存模型</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/threadSafety.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十一、线程安全</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/lockOptimization.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十二、锁优化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaConcurrency/multiThreaded.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>十三、多线程开发良好的实践</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>Java 虚拟机</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaVirtual/runTimeDataArea.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>一、运行时数据区域</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaVirtual/refuseCollection.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>二、垃圾收集</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaVirtual/memoryAllocationAndReclamationPolicy.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>三、内存分配与回收策略</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaVirtual/classLoadingMechanism.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>四、类加载机制</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>Java IO</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/overview.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>一、概览</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/diskOperation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>二、磁盘操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/byteOperation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>三、字节操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/characterOperation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>四、字符操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/objectOperation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>五、对象操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/networkOperation.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>六、网络操作</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link link" href="/vitepress-java/javaIo/nio.html" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>七、NIO</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-497d8e6d><section class="VPSidebarItem level-0 collapsible" data-v-497d8e6d data-v-cf7081fd><div class="item" role="button" tabindex="0" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><h2 class="text" data-v-cf7081fd>其他站点</h2><div class="caret" role="button" aria-label="toggle section" tabindex="0" data-v-cf7081fd><span class="vpi-chevron-right caret-icon" data-v-cf7081fd></span></div></div><div class="items" data-v-cf7081fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link vp-external-link-icon link" href="https://1024bibi.com/" target="_blank" rel="noreferrer" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>个人主页</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-cf7081fd data-v-cf7081fd><div class="item" data-v-cf7081fd><div class="indicator" data-v-cf7081fd></div><a class="VPLink link vp-external-link-icon link" href="https://webvueblog.github.io/vitepress-java/" target="_blank" rel="noreferrer" data-v-cf7081fd><!--[--><p class="text" data-v-cf7081fd>主页</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-29fcaef6 data-v-c6f8ea92><div class="VPDoc has-sidebar has-aside" data-v-c6f8ea92 data-v-3f094f5a><!--[--><!--]--><div class="container" data-v-3f094f5a><div class="aside" data-v-3f094f5a><div class="aside-curtain" data-v-3f094f5a></div><div class="aside-container" data-v-3f094f5a><div class="aside-content" data-v-3f094f5a><div class="VPDocAside" data-v-3f094f5a data-v-1de165c5><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-1de165c5 data-v-b1b322d0><div class="content" data-v-b1b322d0><div class="outline-marker" data-v-b1b322d0></div><div class="outline-title" role="heading" aria-level="2" data-v-b1b322d0>当前页大纲</div><nav aria-labelledby="doc-outline-aria-label" data-v-b1b322d0><span class="visually-hidden" id="doc-outline-aria-label" data-v-b1b322d0> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-b1b322d0 data-v-b2930cab><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-1de165c5></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-3f094f5a><div class="content-container" data-v-3f094f5a><!--[--><!--]--><main class="main" data-v-3f094f5a><div style="position:relative;" class="vp-doc _vitepress-java_javaContainer_codeAnalysis" data-v-3f094f5a><div><h1 id="三、源码分析" tabindex="-1">三、源码分析 <a class="header-anchor" href="#三、源码分析" aria-label="Permalink to &quot;三、源码分析&quot;">​</a></h1><p>基于 JDK 1.8。</p><p>在 IDEA 中 double shift 调出 Search EveryWhere，查找源码文件，找到之后就可以阅 读源码。</p><h2 id="arraylist" tabindex="-1">ArrayList <a class="header-anchor" href="#arraylist" aria-label="Permalink to &quot;ArrayList&quot;">​</a></h2><ol><li>概览</li></ol><p>因为 ArrayList 是基于数组实现的，所以支持快速随机访问。RandomAccess 接口标识 着该类支持快速随机访问。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public class ArrayList&lt;E&gt; extends AbstractList&lt;E&gt;</span></span>
<span class="line"><span>implements List&lt;E&gt;, RandomAccess, Cloneable,</span></span>
<span class="line"><span>java.io.Serializable</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>数组的默认大小为 10。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private static final int DEFAULT_CAPACITY = 10;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="/vitepress-java/assets/img_4.Dm6gEoXe.png" alt="img_4.png" loading="lazy"></p><ol start="2"><li>扩容</li></ol><p>添加元素时使用 ensureCapacityInternal() 方法来保证容量足够，如果不够时，需要使 用 grow() 方法进行扩容，新容量的大小为 <code>oldCapacity + (oldCapacity &gt;&gt; 1)</code> ，即 <code>oldCapacity+oldCapacity/2</code>。其中 <code>oldCapacity &gt;&gt; 1</code> 需要取整，所以新容量大 约是旧容量的 1.5 倍左右。（oldCapacity 为偶数就是 1.5 倍，为奇数就是 1.5 倍-0.5）</p><p>扩容操作需要调用 Arrays.copyOf() 把原数组整个复制到新数组中，这个操作代 价很高，因此最好在创建 ArrayList 对象时就指定大概的容量大小，减少扩容操作的 次数。</p><p><img src="/vitepress-java/assets/img_5.BXpdoCKO.png" alt="img_5.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_6.Dn6jRcjh.png" alt="img_6.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_7.B286UV66.png" alt="img_7.png" loading="lazy"></p><ol start="3"><li>删除元素</li></ol><p>需要调用 System.arraycopy() 将 index+1 后面的元素都复制到 index 位置上，该操作 的时间复杂度为 O(N)，可以看到 ArrayList 删除元素的代价是非常高的。</p><p><img src="/vitepress-java/assets/img_8.BsHVs2qa.png" alt="img_8.png" loading="lazy"></p><ol start="4"><li>序列化</li></ol><p>ArrayList 基于数组实现，并且具有动态扩容特性，因此保存元素的数组不一定都会 被使用，那么就没必要全部进行序列化。</p><p>保存元素的数组 elementData 使用 transient 修饰，该关键字声明数组默认不会被序列 化。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>transient Object[] elementData; // non-private to simplify nested</span></span>
<span class="line"><span>class access</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>ArrayList 实现了 writeObject() 和 readObject() 来控制只序列化数组中有元素填充那部 分内容。</p><p><img src="/vitepress-java/assets/img_9.B7WgZhfD.png" alt="img_9.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_10.sxczic8T.png" alt="img_10.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_11.Db2JO_a3.png" alt="img_11.png" loading="lazy"></p><p>序列化时需要使用 ObjectOutputStream 的 writeObject() 将对象转换为字节流并输出。 而 writeObject() 方法在传入的对象存在 writeObject() 的时候会去反射调用该对象的 writeObject() 来实现序列化。反序列化使用的是 ObjectInputStream 的 readObject() 方 法，原理类似。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>ArrayList list = new ArrayList();</span></span>
<span class="line"><span>ObjectOutputStream oos = new ObjectOutputStream(new</span></span>
<span class="line"><span>FileOutputStream(file));</span></span>
<span class="line"><span>oos.writeObject(list);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="5"><li>Fail-Fast</li></ol><p>modCount 用来记录 ArrayList 结构发生变化的次数。结构发生变化是指添加或者删除 至少一个元素的所有操作，或者是调整内部数组的大小，仅仅只是设置元素的值不算 结构发生变化。</p><p>在进行序列化或者迭代等操作时，需要比较操作前后 modCount 是否改变，如果改变 了需要抛出 ConcurrentModificationException。代码参考上节序列化中的 writeObject() 方法。</p><h2 id="vector" tabindex="-1">Vector <a class="header-anchor" href="#vector" aria-label="Permalink to &quot;Vector&quot;">​</a></h2><ol><li>同步</li></ol><p>它的实现与 ArrayList 类似，但是使用了 synchronized 进行同步。</p><p><img src="/vitepress-java/assets/img_12.Cq8bIAY5.png" alt="img_12.png" loading="lazy"></p><ol start="2"><li>扩容</li></ol><p>Vector 的构造函数可以传入 capacityIncrement 参数，它的作用是在扩容时使容量 capacity 增长 capacityIncrement。如果这个参数的值小于等于 0，扩容时每次都令 capacity 为原来的两倍。</p><p><img src="/vitepress-java/assets/img_13.p2uLg0z6.png" alt="img_13.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_14.DYvB3gAW.png" alt="img_14.png" loading="lazy"></p><p>调用没有 capacityIncrement 的构造函数时，capacityIncrement 值被设置为 0，也就是 说默认情况下 Vector 每次扩容时容量都会翻倍。</p><p><img src="/vitepress-java/assets/img_15.BjCfpRWo.png" alt="img_15.png" loading="lazy"></p><ol start="3"><li>与 ArrayList 的比较</li></ol><p>Vector 是同步的，因此开销就比 ArrayList 要大，访问速度更慢。最好使用 ArrayList 而不是 Vector，因为同步操作完全可以由程序员自己来控制；</p><p>Vector 每次扩容请求其大小的 2 倍（也可以通过构造函数设置增长的容量），而 ArrayList 是 1.5 倍。</p><ol start="4"><li>替代方案</li></ol><p>可以使用 Collections.synchronizedList(); 得到一个线程安全的 ArrayList。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>List&lt;String&gt; list = new ArrayList&lt;&gt;();</span></span>
<span class="line"><span>List&lt;String&gt; synList = Collections.synchronizedList(list);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>也可以使用 concurrent 并发包下的 CopyOnWriteArrayList 类。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="copyonwritearraylist" tabindex="-1">CopyOnWriteArrayList <a class="header-anchor" href="#copyonwritearraylist" aria-label="Permalink to &quot;CopyOnWriteArrayList&quot;">​</a></h2><ol><li>读写分离</li></ol><p>写操作在一个复制的数组上进行，读操作还是在原始数组中进行，读写分离，互不影 响</p><p>写操作需要加锁，防止并发写入时导致写入数据丢失。</p><p>写操作结束之后需要把原始数组指向新的复制数组。</p><p><img src="/vitepress-java/assets/img_16.lX4ZpLmF.png" alt="img_16.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_17.SCHNcZVJ.png" alt="img_17.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_18.BEhkCsyX.png" alt="img_18.png" loading="lazy"></p><ol start="2"><li>适用场景</li></ol><p>CopyOnWriteArrayList 在写操作的同时允许读操作，大大提高了读操作的性能，因此 很适合读多写少的应用场景。</p><p>但是 CopyOnWriteArrayList 有其缺陷：</p><p>内存占用：在写操作时需要复制一个新的数组，使得内存占用为原来的两倍左 右；</p><p>数据不一致：读操作不能读取实时性的数据，因为部分写操作的数据还未同步到 读数组中。</p><p>所以 CopyOnWriteArrayList 不适合内存敏感以及对实时性要求很高的场景.</p><h2 id="linkedlist" tabindex="-1">LinkedList <a class="header-anchor" href="#linkedlist" aria-label="Permalink to &quot;LinkedList&quot;">​</a></h2><ol><li>概览</li></ol><p>基于双向链表实现，使用 Node 存储链表节点信息。</p><p><img src="/vitepress-java/assets/img_19.DrqZaXSt.png" alt="img_19.png" loading="lazy"></p><p>每个链表存储了 first 和 last 指针：</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>transient Node&lt;E&gt; first;</span></span>
<span class="line"><span>transient Node&lt;E&gt; last;// 尾指针</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/vitepress-java/assets/img_20.B-pNzr_0.png" alt="img_20.png" loading="lazy"></p><ol start="2"><li>与 ArrayList 的比较</li></ol><p>ArrayList 基于动态数组实现，LinkedList 基于双向链表实现。ArrayList 和 LinkedList 的区别可以归结为数组和链表的区别：</p><ul><li>数组支持随机访问，但插入删除的代价很高，需要移动大量元素；</li><li>链表不支持随机访问，但插入删除只需要改变指针。</li></ul><h2 id="hashmap" tabindex="-1">HashMap <a class="header-anchor" href="#hashmap" aria-label="Permalink to &quot;HashMap&quot;">​</a></h2><p>为了便于理解，以下源码分析以 JDK 1.7 为主。</p><ol><li>存储结构</li></ol><p>内部包含了一个 Entry 类型的数组 table。Entry 存储着键值对。它包含了四个字段， 从 next 字段我们可以看出 Entry 是一个链表。即数组中的每个位置被当成一个桶， 一个桶存放一个链表。HashMap 使用拉链法来解决冲突，同一个链表中存放哈希值 和散列桶取模运算结果相同的 Entry。</p><p><img src="/vitepress-java/assets/img_21.BX_XG2CG.png" alt="img_21.png" loading="lazy"></p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>transient Entry[] table;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="/vitepress-java/assets/img_22.VY53Ljam.png" alt="img_22.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_23.CTSWvd-m.png" alt="img_23.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_24.C5S1cANB.png" alt="img_24.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_25.bTA_zRhH.png" alt="img_25.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_26.DwoUtwaZ.png" alt="img_26.png" loading="lazy"></p><ol start="2"><li>拉链法的工作原理</li></ol><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();</span></span>
<span class="line"><span>map.put(&quot;K1&quot;, &quot;V1&quot;);</span></span>
<span class="line"><span>map.put(&quot;K2&quot;, &quot;V2&quot;);</span></span>
<span class="line"><span>map.put(&quot;K3&quot;, &quot;V3&quot;);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>新建一个 HashMap，默认大小为 16；</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>插入 &lt; K1,V1 &gt; 键值对，先计算 K1 的 hashCode 为 115，使用除留余数法得到所</span></span>
<span class="line"><span>在的桶下标 115%16=3。</span></span>
<span class="line"><span>插入 &lt; K2,V2 &gt; 键值对，先计算 K2 的 hashCode 为 118，使用除留余数法得到所</span></span>
<span class="line"><span>在的桶下标 118%16=6。</span></span>
<span class="line"><span>插入 &lt; K3,V3 &gt; 键值对，先计算 K3 的 hashCode 为 118，使用除留余数法得到所</span></span>
<span class="line"><span>在的桶下标 118%16=6，插在 &lt; K2,V2 &gt; 前面。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>应该注意到链表的插入是以头插法方式进行的，例如上面的 <code>&lt;K3,V3&gt;</code> 不是插在 <code>&lt;K2,V2&gt;</code> 后面，而是插入在链表头部。</p><p>查找需要分成两步进行：</p><ul><li>计算键值对所在的桶；</li><li>在链表上顺序查找，时间复杂度显然和链表的长度成正比。</li></ul><p><img src="/vitepress-java/assets/img_27.BPPP0zxw.png" alt="img_27.png" loading="lazy"></p><ol start="3"><li>put 操作</li></ol><p><img src="/vitepress-java/assets/img_28.Dgzt8dhH.png" alt="img_28.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_29.eWEkTraW.png" alt="img_29.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_30.PgjKTfwj.png" alt="img_30.png" loading="lazy"></p><p>HashMap 允许插入键为 null 的键值对。但是因为无法调用 null 的 hashCode() 方法， 也就无法确定该键值对的桶下标，只能通过强制指定一个桶下标来存放。HashMap 使用第 0 个桶存放键为 null 的键值对。</p><p><img src="/vitepress-java/assets/img_31.BMXWFZOE.png" alt="img_31.png" loading="lazy"></p><p>使用链表的头插法，也就是新的键值对插在链表的头部，而不是链表的尾部</p><p><img src="/vitepress-java/assets/img_32.GfoTuGAp.png" alt="img_32.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_33.CqUdg7Dl.png" alt="img_33.png" loading="lazy"></p><ol start="4"><li>确定桶下标</li></ol><p>很多操作都需要先确定一个键值对所在的桶下标。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>int hash = hash(key);</span></span>
<span class="line"><span>int i = indexFor(hash, table.length);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>4.1 计算 hash 值</p><p><img src="/vitepress-java/assets/img_34.Cba5aA3j.png" alt="img_34.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_35.D0YTZGNw.png" alt="img_35.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_36.BI_WFP_5.png" alt="img_36.png" loading="lazy"></p><p>4.2 取模</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>令 x = 1&lt;&lt;4，即 x 为 2 的 4 次方，它具有以下性质：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>x : 00010000</span></span>
<span class="line"><span>x-1 : 00001111</span></span>
<span class="line"><span></span></span>
<span class="line"><span>令一个数 y 与 x-1 做与运算，可以去除 y 位级表示的第 4 位以上数：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>y : 10110010</span></span>
<span class="line"><span>x-1 : 00001111</span></span>
<span class="line"><span>y&amp;(x-1) : 00000010</span></span>
<span class="line"><span></span></span>
<span class="line"><span>这个性质和 y 对 x 取模效果是一样的：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>y : 10110010</span></span>
<span class="line"><span>x : 00010000</span></span>
<span class="line"><span>y%x : 00000010</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>我们知道，位运算的代价比求模运算小的多，因此在进行这种计算时用位运算的话能 带来更高的性能。</p><p>确定桶下标的最后一步是将 key 的 hash 值对桶个数取模：hash%capacity，如果能保 证 capacity 为 2 的 n 次方，那么就可以将这个操作转换为位运算。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span></span></span>
<span class="line"><span>static int indexFor(int h, int length) {</span></span>
<span class="line"><span>return h &amp; (length-1);</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="5"><li>扩容-基本原理</li></ol><p>设 HashMap 的 table 长度为 M，需要存储的键值对数量为 N，如果哈希函数满足均 匀性的要求，那么每条链表的长度大约为 N/M，因此查找的复杂度为 O(N/M)。</p><p>为了让查找的成本降低，应该使 N/M 尽可能小，因此需要保证 M 尽可能大，也就是 说 table 要尽可能大。HashMap 采用动态扩容来根据当前的 N 值来调整 M 值，使得 空间效率和时间效率都能得到保证。</p><p>和扩容相关的参数主要有：capacity、size、threshold 和 load_factor。</p><p><img src="/vitepress-java/assets/img_37.PIxy-a-x.png" alt="img_37.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_38.B4XQmd5G.png" alt="img_38.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_39.DqIPGIlh.png" alt="img_39.png" loading="lazy"></p><p>从下面的添加元素代码中可以看出，当需要扩容时，令 capacity 为原来的两倍。</p><p><img src="/vitepress-java/assets/img_40.CuCj85mo.png" alt="img_40.png" loading="lazy"></p><p>扩容使用 resize() 实现，需要注意的是，扩容操作同样需要把 oldTable 的所有键值对 重新插入 newTable 中，因此这一步是很费时的。</p><p><img src="/vitepress-java/assets/img_41.DTJ1N5dt.png" alt="img_41.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_42.CaMnLKI6.png" alt="img_42.png" loading="lazy"></p><ol start="6"><li>扩容-重新计算桶下标</li></ol><p>在进行扩容时，需要把键值对重新计算桶下标，从而放到对应的桶上。在前面提到， HashMap 使用 hash%capacity 来确定桶下标。HashMap capacity 为 2 的 n 次方这一特 点能够极大降低重新计算桶下标操作的复杂度。</p><p>假设原数组长度 capacity 为 16，扩容之后 new capacity 为 32：</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>capacity : 00010000</span></span>
<span class="line"><span>new capacity : 00100000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>对于一个 Key，它的哈希值 hash 在第 5 位：</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>为 0，那么 hash%00010000 = hash%00100000，桶位置和原来一致；</span></span>
<span class="line"><span>为 1，hash%00010000 = hash%00100000 + 16，桶位置是原位置 + 16。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="7"><li>计算数组容量</li></ol><p>HashMap 构造函数允许用户传入的容量不是 2 的 n 次方，因为它可以自动地将传入 的容量转换为 2 的 n 次方。</p><p>先考虑如何求一个数的掩码，对于 10010000，它的掩码为 11111111，可以使用以下 方法得到：</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>mask |= mask &gt;&gt; 1 11011000</span></span>
<span class="line"><span>mask |= mask &gt;&gt; 2 11111110</span></span>
<span class="line"><span>mask |= mask &gt;&gt; 4 11111111</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>mask+1 是大于原始数字的最小的 2 的 n 次方。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>num 10010000</span></span>
<span class="line"><span>mask+1 100000000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>以下是 HashMap 中计算数组容量的代码：</p><p><img src="/vitepress-java/assets/img_43.Da4N8e8v.png" alt="img_43.png" loading="lazy"></p><ol start="8"><li>链表转红黑树</li></ol><p>从 JDK 1.8 开始，一个桶存储的链表长度大于等于 8 时会将链表转换为红黑树。</p><ol start="9"><li><p>与 Hashtable 的比较</p></li><li><p>Hashtable 使用 synchronized 来进行同步。</p></li><li><p>HashMap 可以插入键为 null 的 Entry。</p></li><li><p>HashMap 的迭代器是 fail-fast 迭代器。</p></li><li><p>HashMap 不能保证随着时间的推移 Map 中的元素次序是不变的。</p></li></ol><h2 id="concurrenthashmap" tabindex="-1">ConcurrentHashMap <a class="header-anchor" href="#concurrenthashmap" aria-label="Permalink to &quot;ConcurrentHashMap&quot;">​</a></h2><ol><li>存储结构</li></ol><p><img src="/vitepress-java/assets/img_44.Dxd8Ylgy.png" alt="img_44.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_45.BpZgz5h3.png" alt="img_45.png" loading="lazy"></p><p>ConcurrentHashMap 和 HashMap 实现上类似，最主要的差别是 ConcurrentHashMap 采用了分段锁（Segment），每个分段锁维护着几个桶（HashEntry），多个线程可以 同时访问不同分段锁上的桶，从而使其并发度更高（并发度就是 Segment 的个 数）。</p><p>Segment 继承自 ReentrantLock。</p><p><img src="/vitepress-java/assets/img_46.nEGtpF5v.png" alt="img_46.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_47.-AwcJUY7.png" alt="img_47.png" loading="lazy"></p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final Segment&lt;K,V&gt;[] segments;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>默认的并发级别为 16，也就是说默认创建 16 个 Segment。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>static final int DEFAULT_CONCURRENCY_LEVEL = 16;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ol start="2"><li>size 操作</li></ol><p>每个 Segment 维护了一个 count 变量来统计该 Segment 中的键值对个数。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/**</span></span>
<span class="line"><span>* The number of elements. Accessed only either within locks</span></span>
<span class="line"><span>* or among other volatile reads that maintain visibility.</span></span>
<span class="line"><span>*/</span></span>
<span class="line"><span>transient int count;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在执行 size 操作时，需要遍历所有 Segment 然后把 count 累计起来。</p><p>ConcurrentHashMap 在执行 size 操作时先尝试不加锁，如果连续两次不加锁操作得到 的结果一致，那么可以认为这个结果是正确的。</p><p>尝试次数使用 RETRIES_BEFORE_LOCK 定义，该值为 2，retries 初始值为 -1，因此 尝试次数为 3。</p><p>如果尝试的次数超过 3 次，就需要对每个 Segment 加锁。</p><p><img src="/vitepress-java/assets/img_48.DkiymIii.png" alt="img_48.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_49.CULuMl_1.png" alt="img_49.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_50.CKEQjc_W.png" alt="img_50.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_51.B-dZq896.png" alt="img_51.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_52.C6ItJiWv.png" alt="img_52.png" loading="lazy"></p><ol start="3"><li>JDK 1.8 的改动</li></ol><p>JDK 1.7 使用分段锁机制来实现并发更新操作，核心类为 Segment，它继承自重入锁 ReentrantLock，并发度与 Segment 数量相等。</p><p>JDK 1.8 使用了 CAS 操作来支持更高的并发度，在 CAS 操作失败时使用内置锁 synchronized。</p><p>并且 JDK 1.8 的实现也在链表过长时会转换为红黑树。</p><h2 id="linkedhashmap" tabindex="-1">LinkedHashMap <a class="header-anchor" href="#linkedhashmap" aria-label="Permalink to &quot;LinkedHashMap&quot;">​</a></h2><p>存储结构</p><p>继承自 HashMap，因此具有和 HashMap 一样的快速查找特性。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>public class LinkedHashMap&lt;K,V&gt; extends HashMap&lt;K,V&gt; implements</span></span>
<span class="line"><span>Map&lt;K,V&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>内部维护了一个双向链表，用来维护插入顺序或者 LRU 顺序。</p><p><img src="/vitepress-java/assets/img_53.DlNEXyaq.png" alt="img_53.png" loading="lazy"></p><p>accessOrder 决定了顺序，默认为 false，此时维护的是插入顺序。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>final boolean accessOrder;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>LinkedHashMap 最重要的是以下用于维护顺序的函数，它们会在 put、get 等方法中 调用。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>void afterNodeAccess(Node&lt;K,V&gt; p) { }</span></span>
<span class="line"><span>void afterNodeInsertion(boolean evict) { }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>afterNodeAccess()</p></blockquote><p>当一个节点被访问时，如果 accessOrder 为 true，则会将该节点移到链表尾部。也就 是说指定为 LRU 顺序之后，在每次访问一个节点时，会将这个节点移到链表尾部， 保证链表尾部是最近访问的节点，那么链表首部就是最近最久未使用的节点。</p><p><img src="/vitepress-java/assets/img_54.CbPIAN74.png" alt="img_54.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_55.sabGXAEO.png" alt="img_55.png" loading="lazy"></p><blockquote><p>afterNodeInsertion()</p></blockquote><p>在 put 等操作之后执行，当 removeEldestEntry() 方法返回 true 时会移除最晚的节点， 也就是链表首部节点 first。</p><p>evict 只有在构建 Map 的时候才为 false，在这里为 true。</p><p><img src="/vitepress-java/assets/img_56.C9sxEWOh.png" alt="img_56.png" loading="lazy"></p><p>removeEldestEntry() 默认为 false，如果需要让它为 true，需要继承 LinkedHashMap 并 且覆盖这个方法的实现，这在实现 LRU 的缓存中特别有用，通过移除最近最久未使 用的节点，从而保证缓存空间足够，并且缓存的数据都是热点数据。</p><p><img src="/vitepress-java/assets/img_57.Cids5Gxg.png" alt="img_57.png" loading="lazy"></p><blockquote><p>LRU 缓存</p></blockquote><p>以下是使用 LinkedHashMap 实现的一个 LRU 缓存：</p><ol><li>设定最大缓存空间 MAX_ENTRIES 为 3；</li><li>使用 LinkedHashMap 的构造函数将 accessOrder 设置为 true，开启 LRU 顺序；</li><li>覆盖 removeEldestEntry() 方法实现，在节点多于 MAX_ENTRIES 就会将最近最 久未使用的数据移除。</li></ol><p><img src="/vitepress-java/assets/img_58.BC21BLuT.png" alt="img_58.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_59.De5GlXRm.png" alt="img_59.png" loading="lazy"></p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>[3, 1, 4]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="weakhashmap" tabindex="-1">WeakHashMap <a class="header-anchor" href="#weakhashmap" aria-label="Permalink to &quot;WeakHashMap&quot;">​</a></h2><blockquote><p>存储结构</p></blockquote><p>WeakHashMap 的 Entry 继承自 WeakReference，被 WeakReference 关联的对象在下一 次垃圾回收时会被回收。</p><p>WeakHashMap 主要用来实现缓存，通过使用 WeakHashMap 来引用缓存对象，由 JVM 对这部分缓存进行回收。</p><div class="language-angular2html vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">angular2html</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>private static class Entry&lt;K,V&gt; extends WeakReference&lt;Object&gt;</span></span>
<span class="line"><span>implements Map.Entry&lt;K,V&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="concurrentcache" tabindex="-1">ConcurrentCache <a class="header-anchor" href="#concurrentcache" aria-label="Permalink to &quot;ConcurrentCache&quot;">​</a></h3><p>Tomcat 中的 ConcurrentCache 使用了 WeakHashMap 来实现缓存功能。</p><p>ConcurrentCache 采取的是分代缓存：</p><p>经常使用的对象放入 eden 中，eden 使用 ConcurrentHashMap 实现，不用担心会 被回收（伊甸园）；</p><p>不常用的对象放入 longterm，longterm 使用 WeakHashMap 实现，这些老对象会 被垃圾收集器回收。</p><p>当调用 get() 方法时，会先从 eden 区获取，如果没有找到的话再到 longterm 获 取，当从 longterm 获取到就把对象放入 eden 中，从而保证经常被访问的节点不容 易被回收。</p><p>当调用 put() 方法时，如果 eden 的大小超过了 size，那么就将 eden 中的所有对象 都放入 longterm 中，利用虚拟机回收掉一部分不经常使用的对象。</p><p><img src="/vitepress-java/assets/img_60.Bqeytrfu.png" alt="img_60.png" loading="lazy"></p><p><img src="/vitepress-java/assets/img_61.gd3uxkRe.png" alt="img_61.png" loading="lazy"></p></div></div></main><footer class="VPDocFooter" data-v-3f094f5a data-v-a12b5681><!--[--><!--]--><!----><nav class="prev-next" data-v-a12b5681><div class="pager" data-v-a12b5681><a class="VPLink link pager-link prev" href="/vitepress-java/javaContainer/design.html" data-v-a12b5681><!--[--><span class="desc" data-v-a12b5681>上一页</span><span class="title" data-v-a12b5681>二、容器中的设计模式</span><!--]--></a></div><div class="pager" data-v-a12b5681><a class="VPLink link pager-link next" href="/vitepress-java/javaConcurrency/useThread.html" data-v-a12b5681><!--[--><span class="desc" data-v-a12b5681>下一页</span><span class="title" data-v-a12b5681>一、使用线程</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-29fcaef6 data-v-6955ca4d><div class="container" data-v-6955ca4d><p class="message" data-v-6955ca4d>如有转载或 CV 的请标注本站原文地址</p><p class="copyright" data-v-6955ca4d>Copyright © 2019-present Jeskson</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"fr_index.md\":\"C8w3fTXQ\",\"assets.md\":\"cRK-WSIs\",\"configuration.md\":\"DReV3G0B\",\"en_index.md\":\"CYbwVK-O\",\"changelog.md\":\"Pv0r7n1S\",\"components.md\":\"DU1PP-9H\",\"java_inference.md\":\"Bfrl1oFc\",\"index.md\":\"drXC5f0r\",\"java_t.md\":\"P3tNcQC0\",\"java_annotation.md\":\"DRaVCYFG\",\"frontmatter.md\":\"CfG00vlJ\",\"java_exception.md\":\"BaoNeaRW\",\"getting-started.md\":\"Bwu4_N6f\",\"java_data-types.md\":\"DAEJALJC\",\"java_extend.md\":\"BMlc97_Y\",\"java_string.md\":\"DV4ao-u0\",\"java_by.md\":\"DJd2gHN6\",\"java_key-value.md\":\"D2iIwvVS\",\"java_reflection.md\":\"DGx-YtjM\",\"javaconcurrency_collaborationthreads.md\":\"-vDjU86N\",\"javaconcurrency_examplethread.md\":\"4fiRXjOP\",\"javaconcurrency_basicthreading.md\":\"Dtic_bgX\",\"java_object.md\":\"BPIeUQP4\",\"javaconcurrency_interrupt.md\":\"Bce3o2Pb\",\"javaconcurrency_exclusivesynchronization.md\":\"DhvxJlSa\",\"javaconcurrency_lockoptimization.md\":\"HDQmRCUw\",\"javaconcurrency_juc-other.md\":\"B3RYQh9B\",\"javaconcurrency_memorymodel.md\":\"CvN6Zc1I\",\"javaconcurrency_threadstate.md\":\"eelefcAO\",\"javaconcurrency_threadsafety.md\":\"tfIdFhn4\",\"javaio_diskoperation.md\":\"DmEcMWqS\",\"javacontainer_overview.md\":\"BxHhBavC\",\"javaio_nio.md\":\"DCXx3ho7\",\"javaconcurrency_multithreaded.md\":\"Cj_PZ692\",\"javaio_byteoperation.md\":\"Cp3F0o51\",\"javaio_overview.md\":\"CtU6KGOm\",\"javaconcurrency_usethread.md\":\"Kqbw-VFE\",\"javacontainer_design.md\":\"BrgPh4Y4\",\"javaio_networkoperation.md\":\"C7OW1RE9\",\"javaconcurrency_juc-aqs.md\":\"ChBpgFUC\",\"javacontainer_codeanalysis.md\":\"DFus7MAX\",\"javavirtual_classloadingmechanism.md\":\"Dl42DAKJ\",\"javavirtual_refusecollection.md\":\"Bf0vrXxm\",\"javaio_characteroperation.md\":\"huNaRMZf\",\"javaio_objectoperation.md\":\"BLJORqBg\",\"javavirtual_runtimedataarea.md\":\"C_KpMnTa\",\"javavirtual_memoryallocationandreclamationpolicy.md\":\"CTB5t9ka\",\"nav_ahua.md\":\"DI38h0DG\",\"layout.md\":\"WPXzGVlv\",\"markdown.md\":\"DCTYkWeG\",\"nav_mao.md\":\"ESJKdT3Y\",\"nginx-tutorial_nginx-faq.md\":\"BnuVBBlr\",\"nginx-tutorial_nginx-ops.md\":\"C7z1U2Ls\",\"soft_nodejs.md\":\"DMdZL-pq\",\"soft_gitlab.md\":\"CPdL3ora\",\"soft_jdk.md\":\"BjglWwj0\",\"soft_elastic.md\":\"C043WP8M\",\"preface.md\":\"BKJVSaUT\",\"team.md\":\"CguQKjpe\",\"update.md\":\"DLComnZu\",\"plugin.md\":\"BWAz2QDY\",\"soft_nacos.md\":\"dvHWUcKJ\",\"soft_svn.md\":\"D1cUznCP\",\"soft_jenkins.md\":\"B6Ez40G7\",\"soft_nexus.md\":\"CKHgGu2_\",\"soft_tomcat.md\":\"DQCuh_13\",\"soft_yapi.md\":\"BulJk7fK\",\"soft_emqx.md\":\"EMfsvVN2\",\"soft_maven.md\":\"CFo2xCdP\",\"soft_kafka.md\":\"DkXvOwOA\",\"soft_rocketmq.md\":\"BycBZSmD\",\"nginx-tutorial_nginx-quickstart.md\":\"ClkhxVGf\",\"page.md\":\"CocovBms\",\"nginx-tutorial_nginx-configuration.md\":\"Bc_NgwTc\",\"nav_index.md\":\"BW8twA4v\",\"style.md\":\"vdRTkx37\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Java\",\"description\":\"我的Java文档是一个 Java 核心技术教程。\",\"base\":\"/vitepress-java/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":\"dark\",\"themeConfig\":{\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"软件安装配置\",\"items\":[{\"text\":\"开发环境\",\"items\":[{\"text\":\"JDK 安装\",\"link\":\"/soft/JDK\"},{\"text\":\"Maven 安装\",\"link\":\"/soft/Maven\"},{\"text\":\"Nodejs 安装\",\"link\":\"/soft/Nodejs\"},{\"text\":\"EMQX Docker安装\",\"link\":\"/soft/emqx\"}]},{\"text\":\"开发工具\",\"items\":[{\"text\":\"Nexus 运维\",\"link\":\"/soft/Nexus\"},{\"text\":\"Gitlab 运维\",\"link\":\"/soft/Gitlab\"},{\"text\":\"Jenkins 运维\",\"link\":\"/soft/Jenkins\"},{\"text\":\"Svn 运维\",\"link\":\"/soft/Svn\"},{\"text\":\"YApi 运维\",\"link\":\"/soft/YApi\"}]},{\"text\":\"中间件服务\",\"items\":[{\"text\":\"Elastic 运维\",\"link\":\"/soft/Elastic\"},{\"text\":\"RocketMQ 运维\",\"link\":\"/soft/RocketMQ\"},{\"text\":\"Nacos 运维\",\"link\":\"/soft/Nacos\"}]},{\"text\":\"服务器\",\"items\":[{\"text\":\"Tomcat 运维\",\"link\":\"/soft/Tomcat\"}]},{\"text\":\"大数据服务\",\"items\":[{\"text\":\"Kafka 运维\",\"link\":\"/soft/Kafka\"}]}]},{\"text\":\"日志\",\"items\":[{\"text\":\"Nginx 极简教程\",\"items\":[{\"text\":\"Nginx 快速教程\",\"link\":\"/nginx-tutorial/nginx-quickstart\"},{\"text\":\"Nginx 运维\",\"link\":\"/nginx-tutorial/nginx-ops\"},{\"text\":\"Nginx 配置\",\"link\":\"/nginx-tutorial/nginx-configuration\"},{\"text\":\"Nginx 问题\",\"link\":\"/nginx-tutorial/nginx-faq\"}]}]},{\"text\":\"1.0.0\",\"items\":[{\"text\":\"更新日志\",\"link\":\"/changelog.md\"}]}],\"sidebar\":[{\"text\":\"介绍\",\"collapsed\":false,\"items\":[{\"text\":\"其他博客框架\",\"link\":\"/preface\"}]},{\"text\":\"Java 基础\",\"collapsed\":false,\"items\":[{\"text\":\"一、数据类型\",\"link\":\"/java/data-types\"},{\"text\":\"二、String\",\"link\":\"/java/string\"},{\"text\":\"三、运算\",\"link\":\"/java/by\"},{\"text\":\"四、关键字\",\"link\":\"/java/key-value\"},{\"text\":\"五、Object 通用方法\",\"link\":\"/java/Object\"},{\"text\":\"六、继承\",\"link\":\"/java/extend\"},{\"text\":\"七、反射\",\"link\":\"/java/reflection\"},{\"text\":\"八、异常\",\"link\":\"/java/exception\"},{\"text\":\"九、泛型\",\"link\":\"/java/T\"},{\"text\":\"十、注解\",\"link\":\"/java/annotation\"},{\"text\":\"十一、特性\",\"link\":\"/java/Inference\"}]},{\"text\":\"Java 容器\",\"collapsed\":false,\"items\":[{\"text\":\"一、概览\",\"link\":\"/javaContainer/overview\"},{\"text\":\"二、容器中的设计模式\",\"link\":\"/javaContainer/design\"},{\"text\":\"三、源码分析\",\"link\":\"/javaContainer/codeAnalysis\"}]},{\"text\":\"Java 并发\",\"collapsed\":false,\"items\":[{\"text\":\"一、使用线程\",\"link\":\"/javaConcurrency/useThread\"},{\"text\":\"二、基础线程机制\",\"link\":\"/javaConcurrency/basicThreading\"},{\"text\":\"三、中断\",\"link\":\"/javaConcurrency/interrupt\"},{\"text\":\"四、互斥同步\",\"link\":\"/javaConcurrency/exclusiveSynchronization\"},{\"text\":\"五、线程之间的协作\",\"link\":\"/javaConcurrency/collaborationThreads\"},{\"text\":\"六、线程状态\",\"link\":\"/javaConcurrency/threadState\"},{\"text\":\"七、J.U.C - AQS\",\"link\":\"/javaConcurrency/juc-aqs\"},{\"text\":\"八、J.U.C - 其它组件\",\"link\":\"/javaConcurrency/juc-other\"},{\"text\":\"九、线程不安全示例\",\"link\":\"/javaConcurrency/exampleThread\"},{\"text\":\"十、Java 内存模型\",\"link\":\"/javaConcurrency/memoryModel\"},{\"text\":\"十一、线程安全\",\"link\":\"/javaConcurrency/threadSafety\"},{\"text\":\"十二、锁优化\",\"link\":\"/javaConcurrency/lockOptimization\"},{\"text\":\"十三、多线程开发良好的实践\",\"link\":\"/javaConcurrency/multiThreaded\"}]},{\"text\":\"Java 虚拟机\",\"collapsed\":false,\"items\":[{\"text\":\"一、运行时数据区域\",\"link\":\"/javaVirtual/runTimeDataArea\"},{\"text\":\"二、垃圾收集\",\"link\":\"/javaVirtual/refuseCollection\"},{\"text\":\"三、内存分配与回收策略\",\"link\":\"/javaVirtual/memoryAllocationAndReclamationPolicy\"},{\"text\":\"四、类加载机制\",\"link\":\"/javaVirtual/classLoadingMechanism\"}]},{\"text\":\"Java IO\",\"collapsed\":false,\"items\":[{\"text\":\"一、概览\",\"link\":\"/javaIo/overview\"},{\"text\":\"二、磁盘操作\",\"link\":\"/javaIo/diskOperation\"},{\"text\":\"三、字节操作\",\"link\":\"/javaIo/byteOperation\"},{\"text\":\"四、字符操作\",\"link\":\"/javaIo/characterOperation\"},{\"text\":\"五、对象操作\",\"link\":\"/javaIo/objectOperation\"},{\"text\":\"六、网络操作\",\"link\":\"/javaIo/networkOperation\"},{\"text\":\"七、NIO\",\"link\":\"/javaIo/nio\"}]},{\"text\":\"其他站点\",\"collapsed\":false,\"items\":[{\"text\":\"个人主页\",\"link\":\"https://1024bibi.com/\"},{\"text\":\"主页\",\"link\":\"https://webvueblog.github.io/vitepress-java/\"}]}],\"search\":{\"provider\":\"local\",\"options\":{\"locales\":{\"zh\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}}}},\"socialLinks\":[{\"icon\":{\"svg\":\"<svg t=\\\"1703483542872\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1309 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"6274\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M1147.26896 912.681417l34.90165 111.318583-127.165111-66.823891a604.787313 604.787313 0 0 1-139.082747 22.263717c-220.607239 0-394.296969-144.615936-394.296969-322.758409s173.526026-322.889372 394.296969-322.889372C1124.219465 333.661082 1309.630388 478.669907 1309.630388 656.550454c0 100.284947-69.344929 189.143369-162.361428 256.130963zM788.070086 511.869037a49.11114 49.11114 0 0 0-46.360916 44.494692 48.783732 48.783732 0 0 0 46.360916 44.494693 52.090549 52.090549 0 0 0 57.983885-44.494693 52.385216 52.385216 0 0 0-57.983885-44.494692z m254.985036 0a48.881954 48.881954 0 0 0-46.09899 44.494692 48.620028 48.620028 0 0 0 46.09899 44.494693 52.385216 52.385216 0 0 0 57.983886-44.494693 52.58166 52.58166 0 0 0-57.951145-44.494692z m-550.568615 150.018161a318.567592 318.567592 0 0 0 14.307712 93.212943c-14.307712 1.080445-28.746387 1.768001-43.283284 1.768001a827.293516 827.293516 0 0 1-162.394168-22.296458l-162.001279 77.955749 46.328175-133.811485C69.410411 600.858422 0 500.507993 0 378.38496 0 166.683208 208.689602 0 463.510935 0c227.908428 0 427.594322 133.18941 467.701752 312.379588a427.463358 427.463358 0 0 0-44.625655-2.619261c-220.24709 0-394.100524 157.74498-394.100525 352.126871zM312.90344 189.143369a64.270111 64.270111 0 0 0-69.803299 55.659291 64.532037 64.532037 0 0 0 69.803299 55.659292 53.694846 53.694846 0 0 0 57.852923-55.659292 53.465661 53.465661 0 0 0-57.852923-55.659291z m324.428188 0a64.040926 64.040926 0 0 0-69.574114 55.659291 64.302852 64.302852 0 0 0 69.574114 55.659292 53.694846 53.694846 0 0 0 57.951145-55.659292 53.465661 53.465661 0 0 0-57.951145-55.659291z\\\" p-id=\\\"6275\\\"></path></svg>\"},\"link\":\"https://weixin.qq.com/\",\"ariaLabel\":\"wechat\"}],\"darkModeSwitchLabel\":\"深浅模式\",\"footer\":{\"message\":\"如有转载或 CV 的请标注本站原文地址\",\"copyright\":\"Copyright © 2019-present Jeskson\"},\"sidebarMenuLabel\":\"目录\",\"returnToTopLabel\":\"返回顶部\",\"outline\":{\"level\":[2,3],\"label\":\"当前页大纲\"},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>