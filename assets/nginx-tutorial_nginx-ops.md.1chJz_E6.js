import{_ as s,c as i,o as a,a8 as n}from"./chunks/framework.DDO5B0CJ.js";const e="/vitepress-java/assets/img_3.DfOSMlMm.png",l="/vitepress-java/assets/img_4.DkbAa-pC.png",p="/vitepress-java/assets/img_5.DmjcvV4Y.png",m=JSON.parse('{"title":"Nginx 运维","description":"","frontmatter":{},"headers":[],"relativePath":"nginx-tutorial/nginx-ops.md","filePath":"nginx-tutorial/nginx-ops.md"}'),t={name:"nginx-tutorial/nginx-ops.md"},r=n('<h1 id="nginx-运维" tabindex="-1">Nginx 运维 <a class="header-anchor" href="#nginx-运维" aria-label="Permalink to &quot;Nginx 运维&quot;">​</a></h1><ul><li><a href="#windows-安装">Windows 安装</a></li><li><a href="#linux-安装">Linux 安装</a><ul><li><a href="#rpm-包方式推荐">rpm 包方式（推荐）</a></li><li><a href="#源码编译方式">源码编译方式</a></li></ul></li><li><a href="#linux-开机自启动">Linux 开机自启动</a><ul><li><a href="#rpm-包方式">rpm 包方式</a></li><li><a href="#源码编译方式-1">源码编译方式</a></li></ul></li><li><a href="#脚本">脚本</a></li><li><a href="#参考资料">参考资料</a></li></ul><h2 id="一、普通安装" tabindex="-1">一、普通安装 <a class="header-anchor" href="#一、普通安装" aria-label="Permalink to &quot;一、普通安装&quot;">​</a></h2><h3 id="windows-安装" tabindex="-1">Windows 安装 <a class="header-anchor" href="#windows-安装" aria-label="Permalink to &quot;Windows 安装&quot;">​</a></h3><p>（1）进入<a href="https://nginx.org/en/download.html" target="_blank" rel="noreferrer">官方下载地址</a>，选择合适版本（nginx/Windows-xxx）。</p><p><img src="'+e+'" alt="img_3.png" loading="lazy"></p><p>（2）解压到本地</p><p><img src="'+l+`" alt="img_4.png" loading="lazy"></p><p>（3）启动</p><p>下面以 C 盘根目录为例说明下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> C:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> C:</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ginx-0.8.54</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><blockquote><p>注：Nginx / Win32 是运行在一个控制台程序，而非 windows 服务方式的。服务器方式目前还是开发尝试中。</p></blockquote><h3 id="linux-安装" tabindex="-1">Linux 安装 <a class="header-anchor" href="#linux-安装" aria-label="Permalink to &quot;Linux 安装&quot;">​</a></h3><h4 id="rpm-包方式-推荐" tabindex="-1">rpm 包方式（推荐） <a class="header-anchor" href="#rpm-包方式-推荐" aria-label="Permalink to &quot;rpm 包方式（推荐）&quot;">​</a></h4><p>（1）进入<a href="http://nginx.org/packages/" target="_blank" rel="noreferrer">下载页面</a>，选择合适版本下载。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>（2）安装 nginx rpm 包</p><p>nginx rpm 包实际上安装的是 nginx 的 yum 源。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ivh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.rpm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>（3）正式安装 rpm 包</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>（4）关闭防火墙</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=80/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="源码编译方式" tabindex="-1">源码编译方式 <a class="header-anchor" href="#源码编译方式" aria-label="Permalink to &quot;源码编译方式&quot;">​</a></h4><h5 id="安装编译工具及库" tabindex="-1">安装编译工具及库 <a class="header-anchor" href="#安装编译工具及库" aria-label="Permalink to &quot;安装编译工具及库&quot;">​</a></h5><p>Nginx 源码的编译依赖于 gcc 以及一些库文件，所以必须提前安装。</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zlib</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zlib-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> libtool</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> openssl-devel</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>Nginx 依赖 pcre 库，安装步骤如下：</p><p>（1）下载解压到本地</p><p>进入<a href="https://sourceforge.net/projects/pcre/files/pcre/" target="_blank" rel="noreferrer">pcre 官网下载页面</a>，选择合适的版本下载。</p><p>我选择的是 8.35 版本：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/pcre/pcre-8.35.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/pcre</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pcre-8.35.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（2）编译安装</p><p>执行以下命令：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/pcre/pcre-8.35</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./configure</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（3）检验是否安装成功</p><p>执行 <code>pcre-config --version</code> 命令。</p><h5 id="编译安装-nginx" tabindex="-1">编译安装 Nginx <a class="header-anchor" href="#编译安装-nginx" aria-label="Permalink to &quot;编译安装 Nginx&quot;">​</a></h5><p>安装步骤如下：</p><p>（1）下载解压到本地</p><p>进入官网下载地址：<a href="http://nginx.org/en/download.html" target="_blank" rel="noreferrer">http://nginx.org/en/download.html</a> ，选择合适的版本下载。</p><p>我选择的是 1.12.2 版本：<a href="http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz" target="_blank" rel="noreferrer">http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</a></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nginx/nginx-1.12.2.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> http://nginx.org/download/nginx-1.12.2.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-1.12.2.tar.gz</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（2）编译安装</p><p>执行以下命令：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/nginx/nginx-1.12.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_stub_status_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-http_ssl_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --with-pcre=/opt/pcre/pcre-8.35</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>（3）关闭防火墙</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=80/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --reload</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>（4） 启动 Nginx</p><p>安装成功后，直接执行 <code>nginx</code> 命令即可启动 nginx。</p><p>启动后，访问站点：</p><p><img src="`+p+`" alt="img_5.png" loading="lazy"></p><h4 id="linux-开机自启动" tabindex="-1">Linux 开机自启动 <a class="header-anchor" href="#linux-开机自启动" aria-label="Permalink to &quot;Linux 开机自启动&quot;">​</a></h4><p>Centos7 以上是用 Systemd 进行系统初始化的，Systemd 是 Linux 系统中最新的初始化系统（init），它主要的设计目标是克服 sysvinit 固有的缺点，提高系统的启动速度。Systemd 服务文件以 .service 结尾。</p><h5 id="rpm-包方式" tabindex="-1">rpm 包方式 <a class="header-anchor" href="#rpm-包方式" aria-label="Permalink to &quot;rpm 包方式&quot;">​</a></h5><p>如果是通过 rpm 包安装的，会自动创建 nginx.service 文件。</p><p>直接用命令：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">$</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> enable</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx.service</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>设置开机启动即可。</p><h5 id="源码编译方式-1" tabindex="-1">源码编译方式 <a class="header-anchor" href="#源码编译方式-1" aria-label="Permalink to &quot;源码编译方式&quot;">​</a></h5><p>如果采用源码编译方式，需要手动创建 nginx.service 文件。</p><h2 id="二、docker-安装" tabindex="-1">二、Docker 安装 <a class="header-anchor" href="#二、docker-安装" aria-label="Permalink to &quot;二、Docker 安装&quot;">​</a></h2><ul><li>官网镜像：<a href="https://hub.docker.com/_/nginx/" target="_blank" rel="noreferrer">https://hub.docker.com/_/nginx/</a></li><li>下载镜像：<code>docker pull nginx</code></li><li>启动容器：<code>docker run --name my-nginx -p 80:80 -v /data/docker/nginx/logs:/var/log/nginx -v /data/docker/nginx/conf/nginx.conf:/etc/nginx/nginx.conf:ro -d nginx</code></li><li>重新加载配置（目前测试无效，只能重启服务）：<code>docker exec -it my-nginx nginx -s reload</code></li><li>停止服务：<code>docker exec -it my-nginx nginx -s stop</code> 或者：<code>docker stop my-nginx</code></li><li>重新启动服务：<code>docker restart my-nginx</code></li></ul><h2 id="三、脚本" tabindex="-1">三、脚本 <a class="header-anchor" href="#三、脚本" aria-label="Permalink to &quot;三、脚本&quot;">​</a></h2><blockquote><p>CentOS7 环境安装脚本：</p></blockquote><p><strong>安装说明</strong></p><ul><li>采用编译方式安装 Nginx, 并将其注册为 systemd 服务</li><li>安装路径为：<code>/usr/local/nginx</code></li><li>默认下载安装 <code>1.16.0</code> 版本</li></ul><p><strong>使用方法</strong></p><ul><li>默认安装 - 执行以下任意命令即可：</li></ul><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/nginx-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qO-</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/nginx-install.sh</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> bash</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>自定义安装 - 下载脚本到本地，并按照以下格式执行：</li></ul><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sh</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-install.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [version]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="http://www.dohooe.com/2016/03/03/352.html?utm_source=tuicool&amp;utm_medium=referral" target="_blank" rel="noreferrer">http://www.dohooe.com/2016/03/03/352.html?utm_source=tuicool&amp;utm_medium=referral</a></li><li><a href="https://blog.51cto.com/kling/1253474" target="_blank" rel="noreferrer">nginx+keepalived实现nginx双主高可用的负载均衡</a></li></ul>`,74),h=[r];function d(k,o,c,g,u,F){return a(),i("div",null,h)}const C=s(t,[["render",d]]);export{m as __pageData,C as default};
