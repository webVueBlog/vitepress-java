import{_ as e,c as a,o,a8 as t}from"./chunks/framework.DDO5B0CJ.js";const g=JSON.parse('{"title":"高德地图：定位相关","description":"","frontmatter":{},"headers":[],"relativePath":"Work/1.md","filePath":"Work/1.md"}'),n={name:"Work/1.md"},s=t(`<h1 id="高德地图-定位相关" tabindex="-1">高德地图：定位相关 <a class="header-anchor" href="#高德地图-定位相关" aria-label="Permalink to &quot;高德地图：定位相关&quot;">​</a></h1><h2 id="geolocation定位失败的原因是什么" tabindex="-1">Geolocation定位失败的原因是什么？ <a class="header-anchor" href="#geolocation定位失败的原因是什么" aria-label="Permalink to &quot;Geolocation定位失败的原因是什么？&quot;">​</a></h2><p>JS-API的Geolocation定位插件，融合了HTML5 Geolocation定位接口、精确IP定位服务，以及安卓定位sdk定位。其中与安卓定位sdk的结合使用适用于开发安卓系统的H5应用，需同时使用安卓定位sdk和JS-API。</p><h2 id="geolocation-getcurrentposition获取精确位置的流程是什么样的" tabindex="-1">Geolocation.getCurrentPosition获取精确位置的流程是什么样的？ <a class="header-anchor" href="#geolocation-getcurrentposition获取精确位置的流程是什么样的" aria-label="Permalink to &quot;Geolocation.getCurrentPosition获取精确位置的流程是什么样的？&quot;">​</a></h2><p>1、在PC端，因为原生接口成功率很低，JS-API会优先调用精确IP定位服务，在IP定位失败的时候，尝试使用浏览器原生定位接口进行定位， 如果原生定位接口也定位失败，则返回error事件或回调error信息。定位成功之后我们会对浏览器定位的经纬度结果进行向高德坐标的转化， 并对所有有效定位结果融合地址信息后返回complete事件或者回调complete信息。</p><p>2、在移动端，如果开发者开启了sdk辅助定位，那么安卓手机上我们会优先尝试调用sdk的定位接口，失败之后优先调用浏览器原生定位接口进行定位， 浏览器定位失败之后尝试进行精确IP定位，如果以上三种定位全部尝试失败则返回error事件或回调error信息，否则和PC端的一样， 定位成功之后进行高德坐标转化和地址融合。</p><p>3、我们在定位的回调或者事件响应中返回了message字段，message字段明确指出了每一步的成功和失败原因。</p><h2 id="如果没有拿到message如何获取定位失败错误信息" tabindex="-1">如果没有拿到message如何获取定位失败错误信息？ <a class="header-anchor" href="#如果没有拿到message如何获取定位失败错误信息" aria-label="Permalink to &quot;如果没有拿到message如何获取定位失败错误信息？&quot;">​</a></h2><p>可以通过如下方法获取定位失败信息。</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>//可以拷贝如下代码，使用alert输出定位失败信息//解析定位错误信息functiononError(data) {</span></span>
<span class="line"><span>alert(JSON.stringify(data));</span></span>
<span class="line"><span>document.getElementById(&#39;tip&#39;).innerHTML = &#39;定位失败&#39;;</span></span>
<span class="line"><span>}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="getcurrentposition返回的message原因解析" tabindex="-1">getCurrentPosition返回的message原因解析： <a class="header-anchor" href="#getcurrentposition返回的message原因解析" aria-label="Permalink to &quot;getCurrentPosition返回的message原因解析：&quot;">​</a></h2><p>1、Get ipLocation failed：IP精确定位失败，精确IP定位服务目前无法完全覆盖所有用户IP，失败率在5%左右；</p><p>2、sdk定位失败：请检查sdk的key是否设置好，以及webview的定位权限及应用和系统的定位权限是否开启。</p><p>3、浏览器定位失败，有多种情况：</p><p>1）Browser not Support html5 geolocation：浏览器不支持原生定位接口，如IE较低版本的浏览器等；</p><p>2）Geolocation permission denied：用户禁用了定位权限，需要用户开启设备和浏览器的定位权限，并在浏览器弹窗中点击“允许使用定位”选项。</p><p>3）Geolocation permission denied：浏览器禁止了非安全域的定位请求，比如Chrome、IOS10已陆续禁止，这时候需要升级站点到HTTPS。 注意Chrome不会禁止localhost等域名HTTP协议下的定位。</p><p>4）Geolocation permission denied：Access to geolocation was blocked over secure connection with mixed content， 也就是在Https的页面中引用的http的资源。</p><p>5）Get geolocation time out：浏览器定位超时，包括原生的超时，可以适当增加超时属性的设定值以减少这一现象， 另外还有个别浏览器（如google Chrome浏览器等）本身的定位接口是黑洞，通过其请求定位完全没有回应，也会超时返回失败。</p><p>6）Get geolocation failed：定位失败，Chrome、火狐以及部分套壳浏览器接入的定位服务在国外，有较大限制，失败率高。</p><p>注释：如果定位到城市即可满足需求，建议大家改用Geolocation.getCityInfo方法，可以根据IP返回用户所在城市的基本信息， 包括省、市名称、adcode、citycode、城市中心点，城市矩形边界等信息。</p>`,21),i=[s];function r(p,l,c,d,h,m){return o(),a("div",null,i)}const P=e(n,[["render",r]]);export{g as __pageData,P as default};
